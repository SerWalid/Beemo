{% extends "tailwindBase.html" %}
{% block title %} Batman Story {% endblock %}
{% block header %} {% include 'navbar.html' %} {% endblock %}
{% block body %}
<div class="min-h-screen bg-gray-100 py-12">
  <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg">
    <h1 class="text-4xl font-bold mb-6">Batman - The Kind Hero!</h1>
    
    <!-- Audio Player -->

    <!-- Story Container -->
    <div id="storyContainer" class="text-lg leading-relaxed mb-6 text-gray-700">
      <p id="storyText">
        In a city called Gotham, there was a brave hero named Batman. Batman wore a big cape and a mask, and he loved to help people when they were in trouble.
        <br><br>
        Batman had many cool gadgets, like a fast Bat-car and strong Bat-ropes. He used them to catch the bad guys and keep the city safe. But the best thing about Batman was his kind heart. He always wanted everyone in Gotham to be happy.
        <br><br>
        One day, a sneaky bad guy named Joker tried to cause trouble. But Batman wasnâ€™t scared. He used his Bat-ropes and his smart thinking to stop Joker.
        <br><br>
        Batman had friends too. Robin was his best friend, and Alfred helped him take care of everything. Together, they made sure Gotham was safe and sound. At night, when the stars came out, Batman stood on the tallest building and watched over the city to make sure everyone was safe and asleep. Batman was not just strong and smart, but also very kind. And that made him a true hero. The end!
      </p>
    </div>
    
    <audio id="storyAudio" controls class="w-full mt-6">
      <source src="{{ url_for('static', filename='/audio/batman.mp3') }}" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>

    <!-- Image Display Container -->
    <div id="imageContainer" class="my-6">
      <img id="storyImage" src="" alt="Generated Story Image" class="w-full rounded-lg shadow-md hidden">
    </div>

    <!-- Button to Generate Image -->
    <button id="generateImageBtn" class="bg-blue-500 text-white px-4 py-2 rounded mt-4">Generate Image</button>
  </div>
</div>

<script>
  document.getElementById('generateImageBtn').addEventListener('click', function () {
    // Define the prompt for image generation based on the story context
    const prompt = "i want an image of batman to be a cover for a storytelling for kids ";

    // Show loading state
    const generateButton = document.getElementById('generateImageBtn');
    generateButton.innerText = 'Generating...';
    generateButton.disabled = true;

    // Fetch request to the backend to generate the image
    fetch('/story/generate_image', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ prompt: prompt }),
    })
      .then(response => response.json())
      .then(data => {
        if (data.image_url) {
          // Display the generated image
          const storyImage = document.getElementById('storyImage');
          storyImage.src = data.image_url;
          storyImage.classList.remove('hidden');
        } else {
          alert('Error generating image: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Failed to generate image.');
      })
      .finally(() => {
        // Reset button text and re-enable it
        generateButton.innerText = 'Generate Image';
        generateButton.disabled = false;
      });
  });
</script>
{% endblock %}
